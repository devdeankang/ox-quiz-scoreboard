<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>크아앙 점수판</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Noto Sans KR', sans-serif;
      background: url('./babydragon.jpg') no-repeat center center fixed;
      background-size: cover;
    }
    .bg-overlay {
      background-color: rgba(255, 255, 255, 0.7);
    }
    .scoreboard-container {
      min-width: 360px;
      max-width: 500px;
      width: 90%;
    }
    .entry-row td {
      padding: 0.25rem 0.5rem;
    }
    .entry-row td.name {
      text-align: left;
      white-space: nowrap;
    }
    .entry-row td.score {
      text-align: right;
      white-space: nowrap;
      width: 50px;
    }
  </style>
</head>
<body class="flex items-center justify-center min-h-screen">
  <div id="app" class="scoreboard-container bg-white bg-overlay rounded-lg shadow-lg p-6 text-center">
    <h1 class="text-2xl font-bold mb-4">🐍 크아앙 제2회 이벤트 점수판</h1>
    <table class="w-full mb-4">
      <tbody id="scoreboard" class="text-lg"></tbody>
    </table>
    <div id="admin-panel" class="hidden space-y-2">
      <input id="newName" type="text" placeholder="닉네임" class="border rounded w-full px-2 py-1" />
      <button id="addParticipant" class="bg-blue-500 text-white w-full py-2 rounded">참가자 추가</button>
      <div class="flex space-x-2">
        <button id="resetScores" class="bg-yellow-500 text-white w-full py-2 rounded">점수 초기화</button>
        <button id="resetAll" class="bg-red-500 text-white w-full py-2 rounded">모두 초기화</button>
      </div>
    </div>
    <div id="admin-login" class="mt-4">
      <input id="admin-password" type="password" placeholder="운영진 비밀번호" class="border rounded w-full px-2 py-1 mb-2" />
      <button id="login-btn" class="bg-green-500 text-white w-full py-2 rounded">운영진 로그인</button>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCz1RB8iubjeL1TsHmJ0vydvhrvSkSuIxn8",
      authDomain: "ox-quiz-scoreboard.firebaseapp.com",
      databaseURL: "https://ox-quiz-scoreboard-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "ox-quiz-scoreboard",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const ref = db.ref("scoreboard");
    const gameNumberRef = db.ref("gameNumber");
    const scoreboardEl = document.getElementById("scoreboard");
    const adminPanel = document.getElementById("admin-panel");
    const loginBtn = document.getElementById("login-btn");
    const adminPassword = document.getElementById("admin-password");
    const correctPassword = "admin1234";

    loginBtn.onclick = () => {
      if (adminPassword.value === correctPassword) {
        adminPanel.classList.remove("hidden");
        document.getElementById("admin-login").classList.add("hidden");
      } else {
        alert("비밀번호가 틀렸습니다.");
      }
    };

    function updateUI(data) {
      const entries = Object.entries(data || {}).map(([name, score]) => ({ name, score }));
      entries.sort((a, b) => b.score - a.score);

      scoreboardEl.innerHTML = "";
      entries.forEach((entry, index) => {
        const tr = document.createElement("tr");
        tr.classList.add("entry-row");
        let medal = "";
        if (index === 0) medal = "🥇 ";
        else if (index === 1) medal = "🥈 ";
        else if (index === 2) medal = "🥉 ";
        tr.innerHTML = `
          <td class="name">${medal}${index + 1}. <b>${entry.name}</b></td>
          <td class="score">${entry.score}점</td>
        `;
        scoreboardEl.appendChild(tr);
      });
    }

    ref.on("value", (snapshot) => {
      updateUI(snapshot.val());
    });

    document.getElementById("addParticipant").onclick = () => {
      const name = document.getElementById("newName").value.trim();
      if (!name) return;
      ref.once("value", (snapshot) => {
        const data = snapshot.val() || {};
        if (data[name]) {
          alert("이미 등록된 이름입니다.");
          return;
        }
        ref.child(name).set(0);
        document.getElementById("newName").value = "";
      });
    };

    document.getElementById("resetScores").onclick = () => {
      ref.once("value", (snapshot) => {
        const updates = {};
        snapshot.forEach((child) => {
          updates[child.key] = 0;
        });
        ref.update(updates);
      });
    };

    document.getElementById("resetAll").onclick = () => {
      if (confirm("정말 모든 참가자를 초기화하시겠습니까?")) {
        ref.remove();
      }
    };
  </script>
</body>
</html>
